<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подтверждение заказа №{{ order.id }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; font-size: 14px; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; padding: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        .logo-img { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
        .total { font-weight: bold; background-color: #e9ecef; }
        .center { text-align: center; }
        .right { text-align: right; }
        .bold { font-weight: bold; }
        @media only screen and (max-width: 600px) { .container { padding: 10px; } table th, table td { padding: 4px; font-size: 12px; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- Логотип и заголовок -->
        <div class="logo-img">
            <img src="data:image/png;base64,{{ logo_b64 }}" alt="Cozy.su" style="max-width: 150px; height: auto;">
        </div>
        <h2>cozy-opt.ru</h2>
        <p>Email: cozyopt@gmail.com</p>
        <h3>Спасибо за заказ №{{ order.id }}!</h3>
        <p>В скором времени мы с вами свяжемся для подтверждения и отправки.</p>

        <!-- Детали заказа в "красивом окошке" (таблица, похожая на PDF) -->
        <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 20px 0; background-color: #fafafa;">
            <h4>Ваш заказ:</h4>
            <table>
                <thead>
                    <tr>
                        <th class="center" style="width: 5%;">№</th>
                        <th class="center" style="width: 15%;">Артикул</th>
                        <th style="width: 45%;">Наименование</th>
                        <th class="center" style="width: 10%;">Цена</th>
                        <th class="center" style="width: 10%;">Кол-во</th>
                        <th class="center" style="width: 15%;">Сумма</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td class="center">{{ forloop.counter }}</td>
                        <td class="center">
                            {% if item.article_snapshot %}{{ item.article_snapshot }}{% else %}
                                {% if item.product_price and item.product_price.product %}{{ item.product_price.product.article_number }}{% else %}-{% endif %}
                            {% endif %}
                        </td>
                        <td>
                            {% if item.product_snapshot %}{{ item.product_snapshot }}{% else %}
                                {% if item.product_price and item.product_price.product %}{{ item.product_price.product.title }}{% else %}-{% endif %}
                            {% endif %}
                            (Размер: 
                            {% if item.size_snapshot %}{{ item.size_snapshot }}{% else %}
                                {% if item.product_price and item.product_price.size %}{{ item.product_price.size.title }}{% else %}-{% endif %}
                            {% endif %}
                            )
                        </td>
                        <td class="center">{{ item.price }} ₽</td>
                        <td class="center">{{ item.quantity }} шт</td>
                        <td class="center">{{ item.get_cost }} ₽</td>
                    </tr>
                    {% endfor %}
                    <!-- Доставка -->
                    <tr>
                        <td colspan="3">Выбранный способ доставки: {{ order.delivery_method }}</td>
                        <td colspan="2"></td>
                        {% if order.price_delivery %}
                            <td class="center">{{ order.price_delivery }} ₽</td>
                        {% else %}
                            <td colspan="1"></td>
                        {% endif %}
                    </tr>
                    <!-- Скидка, если есть -->
                    {% if order.discount %}
                    <tr>
                        <td colspan="5" class="right">Скидка:</td>
                        <td class="center">{{ order.discount }} ₽</td>
                    </tr>
                    {% endif %}
                    <!-- Итого -->
                    <tr class="total">
                        <td colspan="5" class="right">Итого:</td>
                        <td class="center">{{ order.get_total_cost }} ₽</td>
                    </tr>
                </tbody>
            </table>
            <!-- Дополнительные данные -->
            <p class="bold right">Количество позиций: {{ total_items }}<br>Общее количество: {{ total_quantity }} шт</p>
            <p>Способ оплаты: По выставленному счету на карту Сбербанка</p>
            <p class="bold">{% if order.paid %}Оплачен{% else %}Не оплачен{% endif %}</p>
            <p><strong>Покупатель:</strong> {{ order.first_name_last_name }}<br><strong>Тел.:</strong> {{ order.phone }}<br><strong>Адрес:</strong> {{ order.address }}, {{ order.region }}, {{ order.city }}</p>
        </div>

        <!-- Футер с контактами -->
        <div style="text-align: center; padding: 20px 0; border-top: 1px solid #ddd; color: #666; font-size: 14px;">
            <p>С уважением,<br>Команда cozy-opt.ru</p>
            <p>Email: cozyopt@gmail.com | Тел: +7 (918) 754-59-64</p>
            <p>Если у вас есть вопросы, напишите нам.</p>
        </div>
    </div>
</body>
</html>
